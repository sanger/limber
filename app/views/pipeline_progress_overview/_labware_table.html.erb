<%
  def state_with_children_badge(labware_record)
    state_with_children = labware_record[:state_with_children]
    render partial: 'state_text_badge', locals: { state: state_with_children, text: state_with_children.humanize }
  end

  def render_header
    content_tag(:tr) do
      content_tag(:th, 'Barcode') +
      content_tag(:th, 'Created') +
      content_tag(:th, 'State') +
      content_tag(:th, 'Updated')
    end
  end

  def render_row(labware_record)
    content_tag(:tr) do
      content_tag(:td, link_to("#{labware_record.labware_barcode&.human}", url_for(labware_record))) +
      content_tag(:td, labware_record.created_at&.strftime('%Y-%m-%d')) +
      content_tag(:td, state_with_children_badge(labware_record) ) +
      content_tag(:td, labware_record.updated_at.strftime('%Y-%m-%d'))
    end
  end

  def render_table(labware)
    number_colums = render_header.scan(/<th>/).size

    content_tag(:table, class: 'table table-striped table-sm border', style: 'table-layout: fixed') do
      content_tag(:thead) { render_header } +
        content_tag(:tbody) do
          if labware.nil? || labware.empty?
            content_tag(:tr) { content_tag(:td, 'No labware found', colspan: number_colums, class: 'text-center text-muted') }
          else
            # list of labware, with a link to each
            labware.map { |labware_record| render_row(labware_record) }.join.html_safe
          end
        end
    end
  end
%>

<%= render_table(labware) %>
